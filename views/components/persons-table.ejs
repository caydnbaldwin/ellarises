<div class="overflow-auto" style="max-height: 65vh;">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="bg-danger-subtle text-danger-emphasis">
      <tr class="text-uppercase small">
        <th scope="col">Name</th>
        <th scope="col">Location</th>
        <th scope="col">Organization</th>
        <th scope="col">Field of Interest</th>
        <th scope="col">Total Donations</th>
        <% if (currentUser?.role === 'admin') { %>
          <th scope="col" class="text-end">Actions</th>
        <% } %>
      </tr>
      </thead>
      <tbody>
      <% persons.forEach(function(currentPerson) { %>
        <tr>
          <td class="fw-semibold text-nowrap">
            <div class="text-danger-emphasis"><%= currentPerson.firstname %> <%= currentPerson.lastname %></div>
          </td>
          <td class="text-nowrap">
            <div class="small">
              <% if (currentPerson.city || currentPerson.state || currentPerson.zipcode) { %>
                <span class="badge rounded-pill bg-danger-subtle text-danger-emphasis">
                  <%= currentPerson.city || '' %><% if (currentPerson.city && currentPerson.state) { %>, <% } %><%= currentPerson.state || '' %><% if ((currentPerson.city || currentPerson.state) && currentPerson.zipcode) { %> <% } %><%= currentPerson.zipcode || '' %>
                </span>
              <% } else { %>
                <span class="text-muted">—</span>
              <% } %>
            </div>
          </td>
          <td>
            <div class="fw-semibold"><%= currentPerson.organization || '—' %></div>
          </td>
          <td>
            <% if (currentPerson.fieldofinterest) { %>
              <span class="badge rounded-pill bg-danger-subtle text-danger-emphasis"><%= currentPerson.fieldofinterest %></span>
            <% } else { %>
              <span class="text-muted small">—</span>
            <% } %>
          </td>
          <td class="fw-semibold">
            <% const totalDonations = Number(currentPerson.totaldonations || 0); %>
            <% if (Number.isNaN(totalDonations)) { %>
              <span class="text-muted">—</span>
            <% } else { %>
              <span class="badge bg-danger-subtle text-danger-emphasis">
                <%= totalDonations.toLocaleString('en-US', { style: 'currency', currency: 'USD' }) %>
              </span>
            <% } %>
          </td>
          <% if (currentUser?.role === 'admin') { %>
            <td>
              <div class="d-flex justify-content-end gap-2">
                <form action="/persons/mi/<%= currentPerson.personid %>" method="GET">
                  <button type="submit" class="btn btn-sm btn-outline-secondary">Edit</button>
                </form>
                <button class="btn btn-sm btn-outline-danger" onclick="deletePerson('<%= currentPerson.personid %>')">Delete</button>
              </div>
            </td>
          <% } %>
        </tr>
      <% }); %>
      </tbody>
    </table>
  </div>
</div>
<script>
  async function deletePerson(personId) {
    if (!confirm('Are you sure you want to delete this person?')) {
      return;
    }
    try {
      const response = await fetch(`/persons/mi/${personId}`, {
        method: 'DELETE'
      });
      if (!response.ok) {
        throw new Error('Failed to delete record.');
      }
      window.location.reload();
    } catch (error) {
      alert(error.message);
    }
  }
</script>