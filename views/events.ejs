<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Events Maintenance</title>
    </head>
    <body>

        <!-- For backend- each "event" is really an event instance. Bring in event instance from the database
        and pass it in as "events". "Events" are searchable by date (eventstart), event name, event type, and event location. This will require
        a join to the events table to get the event name.   -->

        <%- include('components/navbar') %>
        <main class="container-fluid vh-100 d-flex flex-column">
            <div class="py-3">
                <div class="card-body">
                    <h1 class="h4 mb-3">Add Event</h1>
                    <%- include('components/events-add-event') %>
                </div>
                <div class="d-flex align-items-baseline justify-content-between gap-3 mb-2">
                    <h1 class="h3 m-0">Events</h1>
                    <% if (events && events.length) { %>
                    <div class="text-secondary fs-6"><%= events.length %> records</div>
                    <% } %>
                </div>
            </div>

            <% if (events.length===0) { %>
                <div class="flex-grow-1 d-flex align-items-center justify-content-center px-3">
                    <div class="alert alert-warning m-0" role="alert">
                    No events found in the database.
                    </div>
                </div>
            <% } else { %>
                <div class="card flex-grow-1 d-flex flex-column h-50 overflow-auto">
                    <div class="card-header">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-baseline gap-2">
                                <span class="fw-semibold">Event Records</span>
                                <% if (events && events.length) { %>
                                    <span class="badge text-bg-secondary"><%= events.length %></span>
                                <% } %>
                            </div>
                        </div>
                        <% if (session.person.role ==="admin" ) {%>
                            <!-- <%// include('components/events-addevent') %> -->
                            <div class="text-end">
                                <a href="/events/events" class="btn btn-primary">Clear</a>
                                <a href="/events/addevent" class="btn btn-primary">Add Event</a>
                            </div>
                        <%}%>
                        <div class="mt-2">
                            <div class="row g-2">
                                <div class="col-12 col-lg-4">
                                    <%- include('components/events-date') %>
                                </div>
                                <div class="col-12 col-lg-4">
                                    <%- include('components/events-eventname') %>
                                </div>
                                <div class="col-12 col-lg-4">
                                    <%- include('components/events-eventlocation') %>
                                </div>
                                <div class="col-12 col-lg-4">
                                    <%- include('components/events-eventtype') %>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="card-body p-0 overflow-auto d-flex justify-content-center"> -->
                    <div class="card-body p-0 overflow-auto">
                        <div class="table-responsive">
                            <br><%- include('components/events-table') %>
                        </div>
                    </div>
                </div>
            <% } %>
        </main>
    </body>
    <script>
        async function deleteSurvey(eventid, eventstart) {
            if (!confirm('Are you sure you want to delete this event?')) {
                return;
            }
            try {
                const response = await fetch(`/events/delete/${eventid}/${eventstart}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    throw new Error('Failed to delete event.');
                };
                window.location.reload();
            } catch (error) {
                console.error(error);
                alert(error.message);
            }
        };
  </script>
</html>