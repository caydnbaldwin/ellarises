<!-- This is the page that displays all of the events. It has search functionality by a few different
 things (name, date, type, etc). Admin can add, edit, and delete. -->


<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Events Maintenance</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
        <style>
          :root{ --c2:#978EC4; }
          body{font-family:'Montserrat',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
          .page-title{font-family:'DM Serif Display',serif; color:var(--c2)}
        </style>
    </head>
    <body class="bg-light">
<!-- Nav bar -->
        <%- include('components/navbar') %>
        <main class="container-fluid px-3 px-md-4 vh-100 d-flex flex-column">
            <div class="py-3">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h1 class="h4 mb-3">Add Event</h1>
                        <%- include('components/events-add-event') %>
                    </div>
                </div>
                <div class="d-flex align-items-baseline justify-content-between gap-3 mb-2 mt-3">
                    <h1 class="h3 m-0 page-title">Events</h1>
                    <% if (eventinstances && eventinstances.length) { %>
                    <div class="text-secondary fs-6"><%= eventinstances.length %> records</div>
                    <% } %>
                </div>
            </div>

            <% if (eventinstances.length===0) { %>
                <div class="flex-grow-1 d-flex align-items-center justify-content-center px-3">
                    <div class="alert alert-warning m-0" role="alert">
                    No events found in the database.
                    </div>
                </div>
            <% } else { %>
                <div class="card shadow-sm flex-grow-1 d-flex flex-column h-50 overflow-auto">
                    <div class="card-header bg-white">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-baseline gap-2">
                                <span class="fw-semibold">Event Records</span>
                                <% if (eventinstances && eventinstances.length) { %>
                                    <span class="badge text-bg-secondary"><%= eventinstances.length %></span>
                                <% } %>
                            </div>
                        </div>
                        <% if (session.person.role ==="admin" ) { %>
                           
                            <div class="text-end mt-2">
                                <a href="/events/events" class="btn btn-outline-secondary btn-sm">Clear</a>
                                <a href="/events/event" class="btn btn-primary btn-sm">Add Event</a>
                            </div>
                        <% } %>
                        <div class="mt-2">
                            <div class="row g-2">
                    <!-- This is where the user can search by event date, event name, location, or type -->
                                <div class="col-12 col-lg-4">
                                    <%- include('components/events-date') %>
                                </div>
                                <div class="col-12 col-lg-4">
                                    <%- include('components/events-eventname') %>
                                </div>
                                <div class="col-12 col-lg-4">
                                    <%- include('components/events-eventlocation') %>
                                </div>
                                <div class="col-12 col-lg-4">
                                    <%- include('components/events-eventtype') %>
                                </div>
                            </div>
                        </div>
                    </div>
                   
                    <div class="card-body p-0 overflow-auto">
                        <div class="table-responsive">
                            <!-- This is where the actual table of events comes in from the components directory. -->
                            <br><%- include('components/events-table') %>
                        </div>
                    </div>
                </div>
            <% } %>
        </main>
    </body>
    <script>
        // This is the script that allows the event to be deleted.
        async function deleteevent(eventid, eventstart) {
            if (!confirm('Are you sure you want to delete this event?')) {
                return;
            }
            try {
                const response = await fetch(`/events/delete/${eventid}/${eventstart}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    throw new Error('Failed to delete event.');
                };
                window.location.reload();
            } catch (error) {
                console.error(error);
                alert(error.message);
            }
        };
    </script>
</html>